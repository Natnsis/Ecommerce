generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma" 
  previewFeatures = ["relationJoins"]
}

datasource db {
  provider = "postgresql"
}

enum Role {
  ADMIN
  VENDOR
  CUSTOMER
}

model Profile {
  id            String    @id @default(uuid())
  userId        String    @unique 
  firstName     String?
  lastName      String?
  phoneNumber   String?
  address       String?
  profileImage  String?   
  role          Role      @default(CUSTOMER)
  bio           String?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  products               Product[]
  transactionsAsVendor   Transaction[] @relation("VendorTransactions")
  transactionsAsCustomer Transaction[] @relation("CustomerTransactions")
  feedbacks              Feedback[]
  sentChats              Chat[]        @relation("SenderChats")
  receivedChats          Chat[]        @relation("ReceiverChats")

  @@map("profiles")
}

model Category {
  id          String    @id @default(uuid())
  name        String    @unique
  slug        String    @unique  
  description String?
  products    Product[]

  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  @@index([name])
  @@map("categories")
}

model Product {
  id          String    @id @default(uuid())
  name        String
  slug        String    @unique 
  description String?
  price       Decimal   @db.Decimal(10, 2) 
  inStock     Int       @default(0)
  images      String[]  
  thumbnail   String?   

  vendorId    String
  vendor      Profile   @relation(fields: [vendorId], references: [id], onDelete: Cascade)

  categoryId  String
  category    Category  @relation(fields: [categoryId], references: [id], onDelete: Restrict)

  feedbacks   Feedback[]

  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  @@index([name])
  @@index([vendorId])
  @@index([categoryId])
  @@map("products")
}

model Transaction {
  id           String   @id @default(uuid())
  amount       Decimal  @db.Decimal(10, 2)
  status       TransactionStatus @default(PENDING) // Add status for real-world use
  paymentIntentId String? // If using Stripe/PayPal etc.

  vendorId     String
  vendor       Profile  @relation("VendorTransactions", fields: [vendorId], references: [id], onDelete: Restrict)

  customerId   String
  customer     Profile  @relation("CustomerTransactions", fields: [customerId], references: [id], onDelete: Restrict)

  createdAt    DateTime @default(now())

  @@index([vendorId])
  @@index([customerId])
  @@index([createdAt])
  @@map("transactions")
}

enum TransactionStatus {
  PENDING
  COMPLETED
  FAILED
  REFUNDED
}

model Feedback {
  id         String   @id @default(uuid())
  rating     Int      @db.SmallInt 
  title      String?
  note       String
  response   String?  
  images     String[] 

  customerId String
  customer   Profile  @relation(fields: [customerId], references: [id], onDelete: Cascade)

  productId  String
  product    Product  @relation(fields: [productId], references: [id], onDelete: Cascade)

  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  @@index([productId])
  @@index([customerId])
  @@map("feedbacks")
}

model Chat {
  id         String   @id @default(uuid())
  message    String
  isRead     Boolean  @default(false)
  images     String[] 

  senderId   String
  sender     Profile  @relation("SenderChats", fields: [senderId], references: [id], onDelete: Cascade)

  receiverId String
  receiver   Profile  @relation("ReceiverChats", fields: [receiverId], references: [id], onDelete: Cascade)

  createdAt  DateTime @default(now())

  @@index([senderId, receiverId])
  @@index([createdAt sort: Desc])
  @@map("chats")
}
